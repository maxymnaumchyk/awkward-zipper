

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>awkward_zipper.layouts.nanoaod &mdash; awkward-zipper 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />

  
    <link rel="shortcut icon" href="../../../_static/logo_unfilled_with_text.png"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            awkward-zipper
              <img src="../../../_static/logo_unfilled_with_black_text.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">awkward-zipper</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">awkward_zipper.layouts.nanoaod</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for awkward_zipper.layouts.nanoaod</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">awkward</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">awkward_zipper.awkward_util</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">_check_equal_lengths</span><span class="p">,</span>
    <span class="n">_non_materializing_get_field</span><span class="p">,</span>
    <span class="n">_rewrap</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">awkward_zipper.kernels</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">children</span><span class="p">,</span>
    <span class="n">counts2nestedindex</span><span class="p">,</span>
    <span class="n">counts2offsets</span><span class="p">,</span>
    <span class="n">distinct_children_deep</span><span class="p">,</span>
    <span class="n">distinct_parent</span><span class="p">,</span>
    <span class="n">local2globalindex</span><span class="p">,</span>
    <span class="n">nestedindex</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">awkward_zipper.layouts.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseLayoutBuilder</span>


<div class="viewcode-block" id="NanoAOD">
<a class="viewcode-back" href="../../../awkward_zipper.layouts.html#awkward_zipper.NanoAOD">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NanoAOD</span><span class="p">(</span><span class="n">BaseLayoutBuilder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NanoAOD layout builder</span>

<span class="sd">    The NanoAOD layout is built from all branches found in the supplied file, based on</span>
<span class="sd">    the naming pattern of the branches. The following additional arrays are constructed:</span>

<span class="sd">    - Any branches named ``n{name}`` are assumed to be counts branches and converted to offsets ``o{name}``</span>
<span class="sd">    - Any local index branches with names matching ``{source}_{target}Idx*`` are converted to global indexes for the event chunk (postfix ``G``)</span>
<span class="sd">    - Any `nested_items` are constructed, if the necessary branches are available</span>
<span class="sd">    - Any `special_items` are constructed, if the necessary branches are available</span>

<span class="sd">    From those arrays, NanoAOD collections are formed as collections of branches grouped by name, where:</span>

<span class="sd">    - one branch exists named ``name`` and no branches start with ``name_``, interpreted as a single flat array;</span>
<span class="sd">    - one branch exists named ``name``, one named ``n{name}``, and no branches start with ``name_``, interpreted as a single jagged array;</span>
<span class="sd">    - no branch exists named ``{name}`` and many branches start with ``name_*``, interpreted as a flat table; or</span>
<span class="sd">    - one branch exists named ``n{name}`` and many branches start with ``name_*``, interpreted as a jagged table.</span>

<span class="sd">    Collections are assigned mixin types according to the `mixins` mapping.</span>
<span class="sd">    All collections are then zipped into one `base.NanoEvents` record and returned.</span>

<span class="sd">    There is a class-level variable ``warn_missing_crossrefs`` which will alter the behavior of</span>
<span class="sd">    NanoAOD. If warn_missing_crossrefs is true then when a missing global index cross-ref</span>
<span class="sd">    target is encountered a warning will be issued. Regardless, the cross-reference is dropped.</span>

<span class="sd">    The same holds for ``error_missing_events_id``. If error_missing_events_id is true, then when the &#39;run&#39;, &#39;event&#39;,</span>
<span class="sd">    or &#39;luminosityBlock&#39; fields are missing, an exception will be thrown; if it is false, just a warning will be issued.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">warn_missing_crossrefs</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># If True, issues a warning when a missing global index cross-ref target is encountered</span>
    <span class="n">error_missing_event_ids</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># If True, raises an exception when &#39;run&#39;, &#39;event&#39;, or &#39;luminosityBlock&#39; fields are missing</span>

    <span class="n">event_ids</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">ClassVar</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;luminosityBlock&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of NanoAOD event IDs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mixins</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;CaloMET&quot;</span><span class="p">:</span> <span class="s2">&quot;MissingET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ChsMET&quot;</span><span class="p">:</span> <span class="s2">&quot;MissingET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenMET&quot;</span><span class="p">:</span> <span class="s2">&quot;MissingET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MET&quot;</span><span class="p">:</span> <span class="s2">&quot;MissingET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;METFixEE2017&quot;</span><span class="p">:</span> <span class="s2">&quot;MissingET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PuppiMET&quot;</span><span class="p">:</span> <span class="s2">&quot;MissingET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RawMET&quot;</span><span class="p">:</span> <span class="s2">&quot;MissingET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RawPuppiMET&quot;</span><span class="p">:</span> <span class="s2">&quot;MissingET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TkMET&quot;</span><span class="p">:</span> <span class="s2">&quot;MissingET&quot;</span><span class="p">,</span>
        <span class="c1"># pseudo-lorentz: pt, eta, phi, mass=0</span>
        <span class="s2">&quot;IsoTrack&quot;</span><span class="p">:</span> <span class="s2">&quot;PtEtaPhiMCollection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SoftActivityJet&quot;</span><span class="p">:</span> <span class="s2">&quot;PtEtaPhiMCollection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TrigObj&quot;</span><span class="p">:</span> <span class="s2">&quot;PtEtaPhiMCollection&quot;</span><span class="p">,</span>
        <span class="c1"># True lorentz: pt, eta, phi, mass</span>
        <span class="s2">&quot;FatJet&quot;</span><span class="p">:</span> <span class="s2">&quot;FatJet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenDressedLepton&quot;</span><span class="p">:</span> <span class="s2">&quot;PtEtaPhiMCollection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenIsolatedPhoton&quot;</span><span class="p">:</span> <span class="s2">&quot;PtEtaPhiMCollection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenJet&quot;</span><span class="p">:</span> <span class="s2">&quot;PtEtaPhiMCollection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenJetAK8&quot;</span><span class="p">:</span> <span class="s2">&quot;PtEtaPhiMCollection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Jet&quot;</span><span class="p">:</span> <span class="s2">&quot;Jet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LHEPart&quot;</span><span class="p">:</span> <span class="s2">&quot;PtEtaPhiMCollection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SubGenJetAK8&quot;</span><span class="p">:</span> <span class="s2">&quot;PtEtaPhiMCollection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SubJet&quot;</span><span class="p">:</span> <span class="s2">&quot;PtEtaPhiMCollection&quot;</span><span class="p">,</span>
        <span class="c1"># Candidate: lorentz + charge</span>
        <span class="s2">&quot;Electron&quot;</span><span class="p">:</span> <span class="s2">&quot;Electron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LowPtElectron&quot;</span><span class="p">:</span> <span class="s2">&quot;LowPtElectron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Muon&quot;</span><span class="p">:</span> <span class="s2">&quot;Muon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Photon&quot;</span><span class="p">:</span> <span class="s2">&quot;Photon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FsrPhoton&quot;</span><span class="p">:</span> <span class="s2">&quot;FsrPhoton&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tau&quot;</span><span class="p">:</span> <span class="s2">&quot;Tau&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenVisTau&quot;</span><span class="p">:</span> <span class="s2">&quot;GenVisTau&quot;</span><span class="p">,</span>
        <span class="c1"># special</span>
        <span class="s2">&quot;GenPart&quot;</span><span class="p">:</span> <span class="s2">&quot;GenParticle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PV&quot;</span><span class="p">:</span> <span class="s2">&quot;Vertex&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SV&quot;</span><span class="p">:</span> <span class="s2">&quot;SecondaryVertex&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Default configuration for mixin types, based on the collection name.</span>

<span class="sd">    The types are implemented in the `coffea.nanoevents.methods.nanoaod` module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_cross_references</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Electron_genPartIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenPart&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Electron_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;Jet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Electron_photonIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;Photon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LowPtElectron_electronIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;Electron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LowPtElectron_genPartIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenPart&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LowPtElectron_photonIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;Photon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FatJet_genJetAK8Idx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenJetAK8&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FatJet_subJetIdx1&quot;</span><span class="p">:</span> <span class="s2">&quot;SubJet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FatJet_subJetIdx2&quot;</span><span class="p">:</span> <span class="s2">&quot;SubJet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FsrPhoton_muonIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;Muon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenPart_genPartIdxMother&quot;</span><span class="p">:</span> <span class="s2">&quot;GenPart&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenVisTau_genPartIdxMother&quot;</span><span class="p">:</span> <span class="s2">&quot;GenPart&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Jet_electronIdx1&quot;</span><span class="p">:</span> <span class="s2">&quot;Electron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Jet_electronIdx2&quot;</span><span class="p">:</span> <span class="s2">&quot;Electron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Jet_genJetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenJet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Jet_muonIdx1&quot;</span><span class="p">:</span> <span class="s2">&quot;Muon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Jet_muonIdx2&quot;</span><span class="p">:</span> <span class="s2">&quot;Muon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Muon_fsrPhotonIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;FsrPhoton&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Muon_genPartIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenPart&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Muon_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;Jet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Photon_electronIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;Electron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Photon_genPartIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenPart&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Photon_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;Jet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tau_genPartIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenPart&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tau_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;Jet&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cross-references, where an index is to be interpreted with respect to another collection</span>

<span class="sd">    Each such cross-reference will be converted to a global indexer, so that arbitrarily sliced events</span>
<span class="sd">    can still resolve the indirection back the parent events</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nested_items</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;FatJet_subJetIdxG&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;FatJet_subJetIdx1G&quot;</span><span class="p">,</span> <span class="s2">&quot;FatJet_subJetIdx2G&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Jet_muonIdxG&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Jet_muonIdx1G&quot;</span><span class="p">,</span> <span class="s2">&quot;Jet_muonIdx2G&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Jet_electronIdxG&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Jet_electronIdx1G&quot;</span><span class="p">,</span> <span class="s2">&quot;Jet_electronIdx2G&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nested collections, where nesting is accomplished by a fixed-length set of indexers&quot;&quot;&quot;</span>
    <span class="n">nested_index_items</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Jet_pFCandsIdxG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Jet_nConstituents&quot;</span><span class="p">,</span> <span class="s2">&quot;JetPFCands&quot;</span><span class="p">),</span>
        <span class="s2">&quot;FatJet_pFCandsIdxG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;FatJet_nConstituents&quot;</span><span class="p">,</span> <span class="s2">&quot;FatJetPFCands&quot;</span><span class="p">),</span>
        <span class="s2">&quot;GenJet_pFCandsIdxG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;GenJet_nConstituents&quot;</span><span class="p">,</span> <span class="s2">&quot;GenJetCands&quot;</span><span class="p">),</span>
        <span class="s2">&quot;GenFatJet_pFCandsIdxG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;GenJetAK8_nConstituents&quot;</span><span class="p">,</span> <span class="s2">&quot;GenFatJetCands&quot;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nested collections, where nesting is accomplished by assuming the target can be unflattened according to a source counts&quot;&quot;&quot;</span>
    <span class="n">special_items</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;GenPart_distinctParentIdxG&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">distinct_parent</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;GenPart_genPartIdxMotherG&quot;</span><span class="p">,</span> <span class="s2">&quot;GenPart_pdgId&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="s2">&quot;GenPart_childrenIdxG&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">children</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="s2">&quot;nGenPart&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GenPart_genPartIdxMotherG&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="s2">&quot;GenPart_distinctChildrenIdxG&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">children</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="s2">&quot;nGenPart&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GenPart_distinctParentIdxG&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="s2">&quot;GenPart_distinctChildrenDeepIdxG&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">distinct_children_deep</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="s2">&quot;nGenPart&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GenPart_genPartIdxMotherG&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GenPart_pdgId&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Special arrays, where the callable and input arrays are specified in the value&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;latest&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_references</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_cross_references</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;latest&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_references</span><span class="p">[</span><span class="s2">&quot;FatJet_genJetAK8Idx&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_references</span><span class="p">[</span><span class="s2">&quot;FsrPhoton_muonIdx&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_references</span><span class="p">[</span><span class="s2">&quot;Muon_fsrPhotonIdx&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="NanoAOD.v7">
<a class="viewcode-back" href="../../../awkward_zipper.layouts.html#awkward_zipper.NanoAOD.v7">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">v7</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the NanoEvents assuming NanoAODv7</span>

<span class="sd">        For example, one can use ``NanoEventsFactory.from_root(&quot;file.root&quot;, schemaclass=NanoAOD.v7)``</span>
<span class="sd">        to ensure NanoAODv7 compatibility.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            out: NanoAOD</span>
<span class="sd">                Schema assuming NanoAODv7</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s2">&quot;7&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NanoAOD.v6">
<a class="viewcode-back" href="../../../awkward_zipper.layouts.html#awkward_zipper.NanoAOD.v6">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">v6</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the NanoEvents assuming NanoAODv6</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            out: NanoAOD</span>
<span class="sd">                Schema assuming NanoAODv6</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s2">&quot;6&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NanoAOD.v5">
<a class="viewcode-back" href="../../../awkward_zipper.layouts.html#awkward_zipper.NanoAOD.v5">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">v5</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the NanoEvents assuming NanoAODv5</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            out: NanoAOD</span>
<span class="sd">                Schema assuming NanoAODv5</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s2">&quot;5&quot;</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">awkward</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">awkward</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_get_collection_fields</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">collection</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">collection</span><span class="p">))</span>

        <span class="c1"># branches that start with &quot;n&quot;</span>
        <span class="n">counter_fields</span> <span class="o">=</span> <span class="n">_get_collection_fields</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>

        <span class="c1"># parse into high-level records (collections, list collections, and singletons)</span>
        <span class="n">collections</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span> <span class="o">-</span> <span class="n">counter_fields</span><span class="p">}</span>

        <span class="c1"># handles collections with underscore in their names</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_special_collections</span><span class="p">(</span><span class="n">collections</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
            <span class="n">additional_collections</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">collections_to_remove</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
                <span class="c1"># check collections that have only one instance in each event</span>
                <span class="k">if</span> <span class="s2">&quot;n&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="n">collection_counts</span> <span class="o">=</span> <span class="n">_get_collection_fields</span><span class="p">(</span><span class="s2">&quot;n&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
                    <span class="c1"># if however, the fields of this collection have multiple instances in each event</span>
                    <span class="c1"># then we use these fields as collections instead</span>
                    <span class="c1"># Example: &#39;nProton_multiRP&#39; and &#39;nProton_singleRP&#39; fields are present but no &#39;nProton&#39; field</span>
                    <span class="c1"># Then we add new &#39;Proton_multiRP&#39; and &#39;Proton_singleRP&#39; collections and delete &#39;Proton&#39; collection</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection_counts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">additional_collections</span> <span class="o">+=</span> <span class="p">[</span>
                            <span class="n">counts</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">counts</span> <span class="ow">in</span> <span class="n">collection_counts</span>
                            <span class="k">if</span> <span class="n">counts</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="p">]</span>
                        <span class="n">collections_to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="n">collections</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">additional_collections</span><span class="p">)</span>
            <span class="n">collections</span> <span class="o">-=</span> <span class="n">collections_to_remove</span>
            <span class="k">return</span> <span class="n">collections</span>

        <span class="n">collections</span> <span class="o">=</span> <span class="n">_special_collections</span><span class="p">(</span><span class="n">collections</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>

        <span class="c1"># check if data or simulation</span>
        <span class="n">is_data</span> <span class="o">=</span> <span class="s2">&quot;GenPart&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">collections</span>

        <span class="n">new_fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># # Create offsets virtual arrays</span>
        <span class="c1"># for name in counter_fields:</span>
        <span class="c1">#     arr = _non_materializing_get_field(array, name)</span>
        <span class="c1">#     new_fields[name.replace(&quot;n&quot;, &quot;o&quot;, 1)] = counts2offsets(arr)</span>

        <span class="c1"># Check the presence of the event_ids</span>
        <span class="n">missing_event_ids</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">event_id</span> <span class="k">for</span> <span class="n">event_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_ids</span> <span class="k">if</span> <span class="n">event_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_event_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_missing_event_ids</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;There are missing event ID fields: </span><span class="si">{</span><span class="n">missing_event_ids</span><span class="si">}</span><span class="s2"> </span><span class="se">\n\n\</span>
<span class="s2">                    The event ID fields </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">event_ids</span><span class="si">}</span><span class="s2"> are necessary to perform sub-run identification </span><span class="se">\</span>
<span class="s2">                    (e.g. for corrections and sub-dividing data during different detector conditions),</span><span class="se">\</span>
<span class="s2">                    to cross-validate MC and Data (i.e. matching events for comparison), and to generate event displays. </span><span class="se">\</span>
<span class="s2">                    It&#39;s advised to never drop these branches from the dataformat.</span><span class="se">\n\n\</span>
<span class="s2">                    This error can be demoted to a warning by setting the class level variable error_missing_event_ids to False.&quot;</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing event_ids : </span><span class="si">{</span><span class="n">missing_event_ids</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="ne">RuntimeWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Create global index virtual arrays for indirection</span>
        <span class="k">for</span> <span class="n">indexer</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_cross_references</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Gen&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_data</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">indexer</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warn_missing_crossrefs</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Missing cross-reference index for </span><span class="si">{</span><span class="n">indexer</span><span class="si">}</span><span class="s2"> =&gt; </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="ne">RuntimeWarning</span><span class="p">,</span>
                        <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;n&quot;</span> <span class="o">+</span> <span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warn_missing_crossrefs</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Missing cross-reference target for </span><span class="si">{</span><span class="n">indexer</span><span class="si">}</span><span class="s2"> =&gt; </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="ne">RuntimeWarning</span><span class="p">,</span>
                        <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">continue</span>
            <span class="c1"># convert nWhatever to a global index</span>
            <span class="c1"># this used to be transforms.counts2offsets_form + transforms.local2global_form in coffea</span>
            <span class="n">arr_indexer</span> <span class="o">=</span> <span class="n">_non_materializing_get_field</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">indexer</span><span class="p">)</span>
            <span class="n">arr_target</span> <span class="o">=</span> <span class="n">_non_materializing_get_field</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">)</span>
            <span class="n">new_fields</span><span class="p">[</span><span class="n">indexer</span> <span class="o">+</span> <span class="s2">&quot;G&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">local2globalindex</span><span class="p">(</span><span class="n">arr_indexer</span><span class="p">,</span> <span class="n">arr_target</span><span class="p">)</span>

        <span class="c1"># Create nested indexer from Idx1, Idx2, ... arrays</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">indexers</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested_items</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">idx</span> <span class="ow">in</span> <span class="n">new_fields</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indexers</span><span class="p">):</span>
                <span class="n">new_fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">nestedindex</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">_non_materializing_get_field</span><span class="p">(</span><span class="n">new_fields</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indexers</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="c1"># Create nested indexer from n* counts arrays</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">local_counts</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested_index_items</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">local_counts</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">and</span> <span class="s2">&quot;n&quot;</span> <span class="o">+</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">arr_local_counts</span> <span class="o">=</span> <span class="n">_non_materializing_get_field</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">local_counts</span><span class="p">)</span>
                <span class="n">arr_target</span> <span class="o">=</span> <span class="n">_non_materializing_get_field</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span> <span class="o">+</span> <span class="n">target</span><span class="p">)</span>
                <span class="c1"># this used to be transforms.counts2nestedindex_form + transforms.local2global_form in coffea</span>
                <span class="n">new_fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts2nestedindex</span><span class="p">(</span><span class="n">arr_local_counts</span><span class="p">,</span> <span class="n">arr_target</span><span class="p">)</span>

        <span class="c1"># Create any special arrays</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">fcn</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">special_items</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">((</span><span class="n">k</span> <span class="ow">in</span> <span class="n">new_fields</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">args</span><span class="p">):</span>
                <span class="c1"># shortened code: (_non_materializing_get_field(new_fields if k in new_fields else array, k) for k in args)</span>
                <span class="n">input_arrays</span> <span class="o">=</span> <span class="p">()</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                    <span class="n">input_arrays</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="n">_non_materializing_get_field</span><span class="p">(</span>
                            <span class="n">new_fields</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">new_fields</span> <span class="k">else</span> <span class="n">array</span><span class="p">,</span> <span class="n">k</span>
                        <span class="p">),</span>
                    <span class="p">)</span>
                <span class="n">new_fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fcn</span><span class="p">(</span><span class="o">*</span><span class="n">input_arrays</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
            <span class="n">name_with_underscore</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
            <span class="n">mixin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mixins</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;NanoCollection&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;n&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="c1"># buffers in `array`</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">_get_collection_fields</span><span class="p">(</span><span class="n">name_with_underscore</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">_non_materializing_get_field</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>

                    <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">buffers</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">to_buffers</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="p">{</span><span class="s2">&quot;node0-offsets&quot;</span><span class="p">,</span> <span class="s2">&quot;node1-data&quot;</span><span class="p">}</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">buffers</span><span class="p">)</span>
                    <span class="c1"># take flat data</span>
                    <span class="n">content</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="n">name_with_underscore</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">awkward</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">NumpyArray</span><span class="p">(</span>
                            <span class="n">buffers</span><span class="p">[</span><span class="s2">&quot;node1-data&quot;</span><span class="p">],</span>
                            <span class="n">parameters</span><span class="o">=</span><span class="n">arr</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="c1"># new buffers in `new_fields`</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">_get_collection_fields</span><span class="p">(</span><span class="n">name_with_underscore</span><span class="p">,</span> <span class="n">new_fields</span><span class="p">):</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">_non_materializing_get_field</span><span class="p">(</span><span class="n">new_fields</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                    <span class="n">parameters</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">parameters</span>
                    <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">buffers</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">to_buffers</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested_items</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested_index_items</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">special_items</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="p">):</span>
                        <span class="c1"># doubly-jagged case</span>
                        <span class="k">assert</span> <span class="p">{</span><span class="s2">&quot;node0-offsets&quot;</span><span class="p">,</span> <span class="s2">&quot;node1-offsets&quot;</span><span class="p">,</span> <span class="s2">&quot;node2-data&quot;</span><span class="p">}</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span>
                            <span class="n">buffers</span>
                        <span class="p">)</span>
                        <span class="c1"># take singly jagged array</span>
                        <span class="n">content</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="n">name_with_underscore</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">awkward</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">ListOffsetArray</span><span class="p">(</span>
                                <span class="n">offsets</span><span class="o">=</span><span class="n">awkward</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">buffers</span><span class="p">[</span><span class="s2">&quot;node1-offsets&quot;</span><span class="p">]),</span>
                                <span class="n">content</span><span class="o">=</span><span class="n">awkward</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">NumpyArray</span><span class="p">(</span>
                                    <span class="n">buffers</span><span class="p">[</span><span class="s2">&quot;node2-data&quot;</span><span class="p">]</span>
                                <span class="p">),</span>
                                <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">{</span><span class="s2">&quot;node0-offsets&quot;</span><span class="p">,</span> <span class="s2">&quot;node1-data&quot;</span><span class="p">}</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">buffers</span><span class="p">)</span>
                        <span class="c1"># take flat data</span>
                        <span class="n">content</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="n">name_with_underscore</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">awkward</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">NumpyArray</span><span class="p">(</span>
                                <span class="n">buffers</span><span class="p">[</span><span class="s2">&quot;node1-data&quot;</span><span class="p">],</span> <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                <span class="n">_content</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">content</span><span class="o">.</span><span class="n">values</span><span class="p">(),)</span>
                <span class="n">_fields</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">content</span><span class="o">.</span><span class="n">keys</span><span class="p">(),)</span>
                <span class="n">_length</span> <span class="o">=</span> <span class="n">_check_equal_lengths</span><span class="p">(</span><span class="n">_content</span><span class="p">)</span>

                <span class="c1"># combine contents in a RecordArray</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">RecordArray</span><span class="p">(</span>
                    <span class="n">_content</span><span class="p">,</span> <span class="n">_fields</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">_length</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{}</span>
                <span class="p">)</span>
                <span class="c1"># update parameters</span>
                <span class="n">counts</span> <span class="o">=</span> <span class="n">_non_materializing_get_field</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">record</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="s2">&quot;__record__&quot;</span><span class="p">:</span> <span class="n">mixin</span><span class="p">,</span>
                        <span class="s2">&quot;__doc__&quot;</span><span class="p">:</span> <span class="n">counts</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__doc__&quot;</span><span class="p">),</span>
                    <span class="p">}</span>
                <span class="p">)</span>

                <span class="c1"># wrap as jagged array</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="n">counts2offsets</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span>
                <span class="n">output</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">ListOffsetArray</span><span class="p">(</span>
                    <span class="n">offsets</span><span class="o">=</span><span class="n">offsets</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">record</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="c1"># list singleton (can use branch&#39;s own offsets)</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">_non_materializing_get_field</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">output</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">to_layout</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
                <span class="n">output</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;__array__&quot;</span><span class="p">:</span> <span class="n">mixin</span><span class="p">,</span> <span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="c1"># singleton</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">_non_materializing_get_field</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">output</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">to_layout</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># simple collection</span>
                <span class="n">content</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">_get_collection_fields</span><span class="p">(</span><span class="n">name_with_underscore</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">_non_materializing_get_field</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>

                    <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">buffers</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">to_buffers</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="p">{</span><span class="s2">&quot;node0-data&quot;</span><span class="p">}</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">buffers</span><span class="p">)</span>
                    <span class="c1"># take flat data</span>
                    <span class="n">content</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="n">name_with_underscore</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">awkward</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">NumpyArray</span><span class="p">(</span>
                            <span class="n">buffers</span><span class="p">[</span><span class="s2">&quot;node0-data&quot;</span><span class="p">],</span>
                            <span class="c1"># forward parameters</span>
                            <span class="n">parameters</span><span class="o">=</span><span class="n">arr</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="n">_content</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">content</span><span class="o">.</span><span class="n">values</span><span class="p">(),)</span>
                <span class="n">_fields</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">content</span><span class="o">.</span><span class="n">keys</span><span class="p">(),)</span>
                <span class="n">_length</span> <span class="o">=</span> <span class="n">_check_equal_lengths</span><span class="p">(</span><span class="n">_content</span><span class="p">)</span>

                <span class="n">output</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">RecordArray</span><span class="p">(</span>
                    <span class="n">_content</span><span class="p">,</span> <span class="n">_fields</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">_length</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{}</span>
                <span class="p">)</span>
                <span class="c1"># update parameters</span>
                <span class="n">output</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="s2">&quot;__record__&quot;</span><span class="p">:</span> <span class="n">mixin</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="c1"># final nanoevents (most outer) zip</span>
        <span class="n">_content</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">output</span><span class="o">.</span><span class="n">values</span><span class="p">(),)</span>
        <span class="n">_fields</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">output</span><span class="o">.</span><span class="n">keys</span><span class="p">(),)</span>
        <span class="n">_length</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">num</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">nanoevents</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span>
            <span class="n">awkward</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">RecordArray</span><span class="p">(</span><span class="n">_content</span><span class="p">,</span> <span class="n">_fields</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">_length</span><span class="p">),</span>
            <span class="n">behavior</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">behavior</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="c1"># fix virtual array shape generators by re-running from buffers:</span>
        <span class="n">nanoevents</span> <span class="o">=</span> <span class="n">awkward</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span>
            <span class="n">_rewrap</span><span class="p">(</span><span class="n">nanoevents</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NanoEvents&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># add aditional parameters</span>
        <span class="n">nanoevents</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="p">},</span>
                <span class="o">**</span><span class="n">array</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># add ref to itself in attrs</span>
        <span class="n">nanoevents</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;@original_array&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nanoevents</span>

        <span class="k">return</span> <span class="n">nanoevents</span>

<div class="viewcode-block" id="NanoAOD.behavior">
<a class="viewcode-back" href="../../../awkward_zipper.layouts.html#awkward_zipper.NanoAOD.behavior">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">behavior</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Behaviors necessary to implement this schema (dict)&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">awkward_zipper.behaviors</span><span class="w"> </span><span class="kn">import</span> <span class="n">nanoaod</span>

        <span class="k">return</span> <span class="n">nanoaod</span><span class="o">.</span><span class="n">behavior</span></div>
</div>



<div class="viewcode-block" id="PFNanoAOD">
<a class="viewcode-back" href="../../../awkward_zipper.layouts.html#awkward_zipper.PFNanoAOD">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PFNanoAOD</span><span class="p">(</span><span class="n">NanoAOD</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PFNano schema builder</span>

<span class="sd">    PFNano is an extended NanoAOD format that includes PF candidates and secondary vertices</span>
<span class="sd">    More info at https://github.com/cms-jet/PFNano</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mixins</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="n">NanoAOD</span><span class="o">.</span><span class="n">mixins</span><span class="p">,</span>
        <span class="s2">&quot;JetSVs&quot;</span><span class="p">:</span> <span class="s2">&quot;AssociatedSV&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FatJetSVs&quot;</span><span class="p">:</span> <span class="s2">&quot;AssociatedSV&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenJetSVs&quot;</span><span class="p">:</span> <span class="s2">&quot;AssociatedSV&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenFatJetSVs&quot;</span><span class="p">:</span> <span class="s2">&quot;AssociatedSV&quot;</span><span class="p">,</span>
        <span class="s2">&quot;JetPFCands&quot;</span><span class="p">:</span> <span class="s2">&quot;AssociatedPFCand&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FatJetPFCands&quot;</span><span class="p">:</span> <span class="s2">&quot;AssociatedPFCand&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenJetCands&quot;</span><span class="p">:</span> <span class="s2">&quot;AssociatedPFCand&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenFatJetCands&quot;</span><span class="p">:</span> <span class="s2">&quot;AssociatedPFCand&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PFCands&quot;</span><span class="p">:</span> <span class="s2">&quot;PFCand&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenCands&quot;</span><span class="p">:</span> <span class="s2">&quot;PFCand&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">all_cross_references</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="n">NanoAOD</span><span class="o">.</span><span class="n">all_cross_references</span><span class="p">,</span>
        <span class="s2">&quot;FatJetPFCands_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;FatJet&quot;</span><span class="p">,</span>  <span class="c1"># breaks pattern</span>
        <span class="s2">&quot;FatJetPFCands_pFCandsIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;PFCands&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FatJetSVs_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;FatJet&quot;</span><span class="p">,</span>  <span class="c1"># breaks pattern</span>
        <span class="s2">&quot;FatJetSVs_sVIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;SV&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FatJet_electronIdx3SJ&quot;</span><span class="p">:</span> <span class="s2">&quot;Electron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FatJet_muonIdx3SJ&quot;</span><span class="p">:</span> <span class="s2">&quot;Muon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenFatJetCands_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenJetAK8&quot;</span><span class="p">,</span>  <span class="c1"># breaks pattern</span>
        <span class="s2">&quot;GenFatJetCands_pFCandsIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenCands&quot;</span><span class="p">,</span>  <span class="c1"># breaks pattern</span>
        <span class="s2">&quot;GenFatJetSVs_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenJetAK8&quot;</span><span class="p">,</span>  <span class="c1"># breaks pattern</span>
        <span class="s2">&quot;GenFatJetSVs_sVIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;SV&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenJetCands_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenJet&quot;</span><span class="p">,</span>  <span class="c1"># breaks pattern</span>
        <span class="s2">&quot;GenJetCands_pFCandsIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenCands&quot;</span><span class="p">,</span>  <span class="c1"># breaks pattern</span>
        <span class="s2">&quot;GenJetSVs_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;GenJet&quot;</span><span class="p">,</span>  <span class="c1"># breaks pattern</span>
        <span class="s2">&quot;GenJetSVs_sVIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;SV&quot;</span><span class="p">,</span>
        <span class="s2">&quot;JetPFCands_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;Jet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;JetPFCands_pFCandsIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;PFCands&quot;</span><span class="p">,</span>
        <span class="s2">&quot;JetSVs_jetIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;Jet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;JetSVs_sVIdx&quot;</span><span class="p">:</span> <span class="s2">&quot;SV&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SubJet_subGenJetAK8Idx&quot;</span><span class="p">:</span> <span class="s2">&quot;SubGenJetAK8&quot;</span><span class="p">,</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="ScoutingNanoAOD">
<a class="viewcode-back" href="../../../awkward_zipper.layouts.html#awkward_zipper.ScoutingNanoAOD">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ScoutingNanoAOD</span><span class="p">(</span><span class="n">NanoAOD</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ScoutingNano schema builder</span>

<span class="sd">    ScoutingNano is a NanoAOD format that includes Scouting objects</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mixins</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="n">NanoAOD</span><span class="o">.</span><span class="n">mixins</span><span class="p">,</span>
        <span class="s2">&quot;ScoutingJet&quot;</span><span class="p">:</span> <span class="s2">&quot;Jet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ScoutingFatJet&quot;</span><span class="p">:</span> <span class="s2">&quot;FatJet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ScoutingMET&quot;</span><span class="p">:</span> <span class="s2">&quot;MissingET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ScoutingMuonNoVtxDisplacedVertex&quot;</span><span class="p">:</span> <span class="s2">&quot;Vertex&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ScoutingMuonVtxDisplacedVertex&quot;</span><span class="p">:</span> <span class="s2">&quot;Vertex&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ScoutingPrimaryVertex&quot;</span><span class="p">:</span> <span class="s2">&quot;Vertex&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ScoutingElectron&quot;</span><span class="p">:</span> <span class="s2">&quot;Electron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ScoutingPhoton&quot;</span><span class="p">:</span> <span class="s2">&quot;Photon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ScoutingMuonNoVtx&quot;</span><span class="p">:</span> <span class="s2">&quot;Muon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ScoutingMuonVtx&quot;</span><span class="p">:</span> <span class="s2">&quot;Muon&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">all_cross_references</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">NanoAOD</span><span class="o">.</span><span class="n">all_cross_references</span><span class="p">}</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Peter Fackeldey, Maxym Naumchyk.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>